## Конфигурационные параметры времени выполнения

Когда клиент подключён к базе данных, он может воспользоваться двумя командами SQL (и равнозначными функциями), которые предоставляет PostgreSQL для управления параметрами конфигурации:
- Команда `SHOW` позволяет узнать текущее значение всех параметров. Соответствующая ей функция — `current_setting(имя_параметра text)`.
- Команда `SET` позволяет изменить текущее значение параметров, которые действуют локально в рамках сеанса; на другие сеансы она не влияет. Соответствующая ей функция — `set_config(имя_параметра, новое_значение, локально)`.

Кроме того, просмотреть и изменить значения параметров для текущего сеанса можно в системном представлении `pg_settings`:

Запрос на чтение представления выдаёт ту же информацию, что и `SHOW ALL`, но более подробно. Этот подход и более гибкий, так как в нём можно указать условия фильтра или связать результат с другими отношениями.

Выполнение `UPDATE` для этого представления, а именно присвоение значения столбцу, равносильно выполнению команды `SET`. Например, команде
```sql
SET configuration_parameter TO DEFAULT;
```
равнозначен запрос:
```sql
UPDATE pg_settings SET setting = reset_val WHERE name = 'configuration_parameter';
```

Проверить, можно ли изменить параметр "на лету" (значение `false`) или нет можно запросом
```sql
SELECT pending_restart FROM pg_settings WHERE name = 'configuration_parameter';
```

### Установка параметров
Команда `SET` изменяет конфигурационные параметры времени выполнения («на лету»).

Если команда SET (или равнозначная SET SESSION) выполняется внутри транзакции, которая затем прерывается, эффект команды SET пропадает, когда транзакция откатывается. Если же окружающая транзакция фиксируется, этот эффект сохраняется до конца сеанса, если его не переопределит другая команда SET.

Действие SET LOCAL продолжается только до конца текущей транзакции, независимо от того, фиксируется она или нет. Особый случай представляет использование SET с последующей SET LOCAL в одной транзакции: значение, заданное SET LOCAL, будет сохраняться до конца транзакции, но после этого (если транзакция фиксируется) восстановится значение, заданное командой SET.

```
SET [ SESSION | LOCAL ] параметр_конфигурации { TO | = } { значение | 'значение' | DEFAULT }
SET [ SESSION | LOCAL ] TIME ZONE { часовой_пояс | LOCAL | DEFAULT }
```

Пример
```sql
SET TIME ZONE 'Europe/Moscow';
SET search_path = 'my_schema';
SET search_path TO my_schema;
SET search_path = DEFAULT;
```

Также изменить значение параметра можно с помощью функции set_config. Кроме того, выполнив UPDATE в системном представлении pg_settings, можно произвести то же действие, что выполняет SET.

```
set_config(setting_name, new_value, is_local)

```

Если параметр is_local равен true, новое значение будет действовать только в рамках текущей транзакции.


Пример
```sql
SELECT set_config('log_statement_stats', 'off', false);

 set_config
------------
 off
(1 row)
```

### Просмотр текущих параметров
Чтобы посмотреть текущее значение параметра, можно воспользоваться командой `SHOW` или функцией `current_setting(setting_name [, missing_ok ])`. Если параметра с именем setting_name нет, функция current_setting выдаёт ошибку, если только дополнительно не передан параметр missing_ok со значением true.

Пример
```sql
SHOW search_path ;
   search_path
-----------------
 "$user", public

SELECT current_setting('datestyle');

 current_setting
-----------------
 ISO, MDY
(1 row)
```

### Источники
- [Документация](https://postgrespro.ru/docs/postgrespro/10/sql-set) postgrespro.ru
